<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="expires" content="-1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Internet hotspot - Cadastro</title>
    <link rel="stylesheet" href="css/style.css" />
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery.inputmask.min.js"></script>
    <script src="js/script.js"></script>
  </head>
  <body>
    <div class="ie-fixMinHeight">
      <div class="main">
        <div class="wrap animated fadeIn">
          <form
            onsubmit="return sendUser(event)"
            method="POST"
          >
            <input type="hidden" name="dst" value="$(link-orig)" />
            <input type="hidden" name="popup" value="true" />

            <label>
              <img class="ico" src="img/user.svg" alt="#" />
              <input
                name="nome_completo"
                id="nome_completo"
                type="text"
                placeholder="Nome Completo"
                required
              />
            </label>
            <label>
              <img class="ico" src="img/arquivo.png" alt="#" />
              <input
                name="cpf"
                id="cpf"
                type="text"
                inputmode="numeric"
                maxlength="14"
                placeholder="CPF"
                required
              />
            </label>
            <label>
              <img class="ico" src="img/arquivo.png" alt="#" />
              <input
                name="data_nascimento"
                id="data_nascimento"
                type="text"
                inputmode="numeric"
                placeholder="Data de Nascimento"
                required
              />
            </label>
            <label>
              <img class="ico" src="img/telefone.png" alt="#" />
              <input
                name="telefone"
                id="telefone"
                type="text"
                placeholder="Telefone"
                inputmode="numeric"
                required
              />
            </label>
            <label>
              <img class="ico" src="img/adress.png" alt="#" />
              <input
                name="cep"
                id="cep"
                inputmode="numeric"
                type="text"
                placeholder="CEP"
                onblur="buscarCep(this.value)"
                required
              />
            </label>
            <label>
              <img class="ico" src="img/adress.png" alt="#" />
              <input
                name="endereco_completo"
                id="endereco_completo"
                type="text"
                placeholder="Endereço Completo"
              />
            </label>
            <label>
              <img class="ico" src="img/home.png" alt="#" />
              <input
                name="numero_casa"
                type="text"
                placeholder="N° da Residência"
              />
            </label>
            <label>
              <img class="ico" src="img/home.png" alt="#" />
              <input name="complemento" type="text" placeholder="Complemento" />
            </label>

            <label>
              <img class="ico" src="img/e-mail.png" alt="#" />
              <input
                name="email"
                id="email"
                type="text"
                placeholder="E-mail"
                required
              />
            </label>

            <label>
              <img class="ico" src="img/password.svg" alt="#" />
              <input
                name="password"
                id="password"
                type="password"
                placeholder="Senha"
                required
              />
            </label>

            <label>
              <img class="ico" src="img/password.svg" alt="#" />
              <input
                name="password_confirm"
                id="password_confirm"
                type="password"
                placeholder="Confirme a Senha"
                required
              />
            </label>

            <input class="btn--cadastrar" type="submit" value="Cadastrar" />
            <p class="info">
              Já possui uma conta? <a href="$(link-login)">Login</a>
            </p>
          </form>
        </div>
      </div>
    </div>
  </body>
  <script>
    async function sendUser(event) {
      event.preventDefault();
      let headersList = {
        Accept: "*/*",
        "Content-Type": "application/json",
      };

      let bodyContent = JSON.stringify({
        name: document.getElementById("cpf").value,
        password: document.getElementById("password").value,
        email: document.getElementById("email").value,
        comment: document.getElementById("nome_completo").value,
        server: 'hotspot-01',
        profile: 'default',
        ipHotspot: "192.168.1.5"
      });

      let response = await fetch(
        "http://127.0.0.1:3000/api/mikrotik/hotspot/user",
        {
          method: "POST",
          body: bodyContent,
          headers: headersList,
        }
      );

      let data = await response.json();
      if (data.status === 201) {
        alert(data.message);
        setTimeout(() => {
          window.location.href = "./login.html"
        }, 2000)
        // window.location.href = "$(link-orig)";
      }

      if (data.status === 409) {
        alert(data.message);
        // window.location.href = "$(link-orig)";
      }
      return data;
    }
  </script>
</html>
